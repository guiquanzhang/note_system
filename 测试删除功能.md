# 🧪 测试删除功能

## 步骤 1：查看当前笔记状态

```sql
USE cloudnote;
SELECT note_id, title, user_id, deleted, deleted_at 
FROM note 
WHERE user_id = 6 
ORDER BY note_id DESC;
```

## 步骤 2：在浏览器控制台测试删除接口

按 F12 打开控制台，执行：

```javascript
// 获取 token
const token = localStorage.getItem('token')
console.log('Token:', token)

// 测试删除笔记 ID 12（确保这个笔记存在且 deleted = 0）
fetch('http://localhost:8080/api/note/12', {
  method: 'DELETE',
  headers: {
    'Authorization': `Bearer ${token}`
  }
})
.then(res => res.json())
.then(data => {
  console.log('删除接口返回:', data)
})
.catch(err => {
  console.error('删除失败:', err)
})
```

## 步骤 3：立即查看数据库

删除后立即执行：

```sql
USE cloudnote;
SELECT note_id, title, user_id, deleted, deleted_at 
FROM note 
WHERE note_id = 12;
```

**预期结果**：
- `deleted` 应该变成 1
- `deleted_at` 应该有当前时间

## 步骤 4：查看笔记列表接口

```javascript
fetch('http://localhost:8080/api/note/list?pageNum=1&pageSize=20', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
})
.then(res => res.json())
.then(data => {
  console.log('笔记列表:', data.data.records)
  console.log('是否包含 note_id=12:', data.data.records.some(n => n.noteId === 12))
})
```

**预期结果**：
- 列表中不应该包含 note_id = 12
- 所有笔记的 deleted 都应该是 0

## 步骤 5：查看回收站接口

```javascript
fetch('http://localhost:8080/api/note/trash?pageNum=1&pageSize=20', {
  headers: {
    'Authorization': `Bearer ${localStorage.getItem('token')}`
  }
})
.then(res => res.json())
.then(data => {
  console.log('回收站:', data.data.records)
  console.log('是否包含 note_id=12:', data.data.records.some(n => n.noteId === 12))
})
```

**预期结果**：
- 回收站中应该包含 note_id = 12
- 所有笔记的 deleted 都应该是 1

---

## 如果删除后 deleted 还是 0

说明后端代码没有生效，需要：

1. **停止后端服务**
2. **清理编译缓存**：Build → Clean Project
3. **重新编译**：Build → Rebuild Project
4. **重新运行** CloudNoteApplication
5. **查看控制台日志**，确认启动成功

---

## 如果删除后 deleted = 1，但前端列表还显示

说明前端缓存问题：

1. **清除浏览器缓存**：Ctrl + Shift + Delete
2. **硬刷新**：Ctrl + F5
3. **重新登录**
4. **查看 Network 请求**，确认返回的数据中没有已删除的笔记
