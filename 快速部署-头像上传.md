# 🚀 快速部署 - 头像上传功能

## 当前状态
✅ 后端代码已完成（FileController、WebConfig）  
✅ 前端代码已完成（Profile.vue、file.js）  
✅ 配置文件已更新（application.yml）  
⚠️ **需要执行数据库更新**

---

## 立即执行（3步）

### 1️⃣ 执行 SQL（必须）
打开 MySQL 客户端，执行：

```sql
USE cloudnote;

-- 将 avatar 字段从 TEXT 改为 VARCHAR(500)
ALTER TABLE `user` 
MODIFY COLUMN `avatar` VARCHAR(500) COMMENT '用户头像URL';

-- 验证
DESC `user`;
```

### 2️⃣ 重启后端
停止并重新启动 Spring Boot 应用

### 3️⃣ 测试
1. 访问 http://localhost:5173
2. 登录 → 个人信息 → 编辑信息
3. 选择头像 → 保存

---

## 工作原理

### 之前（Base64）
```
用户上传图片 → 转Base64 → 存数据库
问题: 超过 64KB 报错 ❌
```

### 现在（文件存储）
```
用户上传图片 → 保存到硬盘 → 数据库存路径
优点: 无大小限制，性能更好 ✅
```

### 文件位置
- **存储**: `项目根目录/uploads/avatars/abc123.jpg`
- **访问**: `http://localhost:8080/uploads/avatars/abc123.jpg`
- **数据库**: `/uploads/avatars/abc123.jpg`

---

## 验证成功

✅ 上传后在 `uploads/avatars/` 目录看到图片文件  
✅ 数据库 avatar 字段存储的是路径（不是 Base64）  
✅ 头像可以正常显示  

---

## 如有问题

### 问题: 上传失败
- 检查图片是否超过 5MB
- 检查文件类型是否为图片

### 问题: 图片无法显示
- 确认后端已重启
- 检查 `uploads/avatars/` 目录是否存在
- 查看浏览器控制台错误信息

### 问题: 数据库报错
- 确认已执行 SQL 更新语句
- 检查 avatar 字段类型是否为 VARCHAR(500)

---

**详细文档**: 查看 `头像上传功能部署指南.md`
