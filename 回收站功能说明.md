# 🗑️ 回收站功能说明

## ✅ 功能概览

回收站功能已完整实现，支持：
1. ✅ 查看已删除的笔记列表
2. ✅ 恢复已删除的笔记
3. ✅ 永久删除笔记
4. ✅ 清空回收站
5. ✅ 分页显示
6. ✅ 响应式设计

---

## 🎯 功能特性

### 1. 软删除机制
- 删除笔记时不会立即从数据库删除
- 标记为已删除状态（`deleted = 1`）
- 记录删除时间（`deleted_at`）
- 正常笔记列表不显示已删除笔记

### 2. 回收站列表
- 显示所有已删除的笔记
- 按删除时间倒序排列
- 支持分页查看
- 显示笔记标题、内容预览、删除时间、标签

### 3. 恢复功能
- 一键恢复已删除的笔记
- 恢复后笔记回到正常列表
- 清除删除标记和删除时间

### 4. 永久删除
- 从数据库中彻底删除笔记
- 删除后无法恢复
- 需要二次确认

### 5. 清空回收站
- 一键清空所有已删除笔记
- 批量永久删除
- 需要二次确认

---

## 📋 API 接口

### 1. 获取回收站笔记列表
```
GET /api/note/trash?pageNum=1&pageSize=10
Headers: Authorization: Bearer {token}

Response:
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [
      {
        "noteId": 1,
        "title": "已删除的笔记",
        "content": "笔记内容...",
        "userId": 1,
        "categoryId": 1,
        "tags": "标签1,标签2",
        "deleted": 1,
        "deletedAt": "2024-12-20T10:00:00",
        "createdAt": "2024-12-14T10:00:00",
        "updatedAt": "2024-12-14T10:00:00"
      }
    ],
    "total": 10,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

### 2. 恢复笔记
```
PUT /api/note/{noteId}/restore
Headers: Authorization: Bearer {token}

Response:
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 3. 永久删除笔记
```
DELETE /api/note/{noteId}/permanent
Headers: Authorization: Bearer {token}

Response:
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

### 4. 清空回收站
```
DELETE /api/note/trash/empty
Headers: Authorization: Bearer {token}

Response:
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

---

## 🚀 使用指南

### 访问回收站
1. 登录系统
2. 在左侧边栏点击"回收站"菜单
3. 或直接访问 `http://localhost:5173/notes/trash`

### 恢复笔记
1. 在回收站列表中找到要恢复的笔记
2. 点击"恢复"按钮
3. 确认恢复操作
4. 笔记将回到正常列表

### 永久删除笔记
1. 在回收站列表中找到要删除的笔记
2. 点击"永久删除"按钮
3. 确认删除操作（⚠️ 此操作不可恢复）
4. 笔记将从数据库中彻底删除

### 清空回收站
1. 点击页面右上角的"清空回收站"按钮
2. 确认清空操作（⚠️ 此操作不可恢复）
3. 所有已删除笔记将被永久删除

---

## 🧪 测试步骤

### 测试 1: 删除笔记到回收站
```
1. 在笔记列表中选择一条笔记
2. 点击"删除"按钮
3. 确认删除
4. 验证: 笔记从列表中消失
5. 访问回收站
6. 验证: 笔记出现在回收站列表中
```

### 测试 2: 恢复笔记
```
1. 访问回收站
2. 找到一条已删除的笔记
3. 点击"恢复"按钮
4. 确认恢复
5. 验证: 显示"恢复成功"提示
6. 返回笔记列表
7. 验证: 笔记重新出现在列表中
```

### 测试 3: 永久删除笔记
```
1. 访问回收站
2. 找到一条已删除的笔记
3. 点击"永久删除"按钮
4. 确认删除
5. 验证: 显示"删除成功"提示
6. 验证: 笔记从回收站列表中消失
7. 尝试恢复该笔记
8. 验证: 无法找到该笔记
```

### 测试 4: 清空回收站
```
1. 删除多条笔记到回收站
2. 访问回收站
3. 点击"清空回收站"按钮
4. 确认清空
5. 验证: 显示"回收站已清空"提示
6. 验证: 回收站列表为空
7. 验证: 显示"回收站为空"提示
```

### 测试 5: 分页功能
```
1. 删除超过 10 条笔记到回收站
2. 访问回收站
3. 验证: 显示分页组件
4. 切换页码
5. 验证: 显示不同的笔记
6. 修改每页数量
7. 验证: 列表更新
```

### 测试 6: 响应式设计
```
1. 在桌面浏览器访问回收站
2. 验证: 布局正常
3. 按 F12 切换到移动设备模拟
4. 验证: 按钮堆叠显示
5. 验证: 内容自适应宽度
```

---

## 🎨 页面设计

### 页面布局
```
┌─────────────────────────────────────────┐
│  回收站          共 X 条笔记   [清空回收站] │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐  │
│  │ 笔记标题              [恢复][永久删除] │  │
│  │ 笔记内容预览...                    │  │
│  │ 删除时间: 2024-12-20 10:00:00     │  │
│  │ 标签: 学习,Java                    │  │
│  └───────────────────────────────────┘  │
│  ┌───────────────────────────────────┐  │
│  │ 另一条笔记...                      │  │
│  └───────────────────────────────────┘  │
├─────────────────────────────────────────┤
│         [分页组件]                       │
└─────────────────────────────────────────┘
```

### 空状态
```
┌─────────────────────────────────────────┐
│  回收站          共 0 条笔记   [清空回收站] │
├─────────────────────────────────────────┤
│  ℹ️ 回收站为空                           │
│  回收站中的笔记会在 30 天后自动永久删除   │
└─────────────────────────────────────────┘
```

---

## 🔒 安全特性

### 1. 权限验证
- 只能查看自己的已删除笔记
- 只能恢复/删除自己的笔记
- JWT Token 认证

### 2. 二次确认
- 永久删除需要确认
- 清空回收站需要确认
- 防止误操作

### 3. 数据隔离
- 用户之间数据完全隔离
- 查询时自动过滤用户ID

---

## 📊 数据库变更

### Note 表新增字段
```sql
ALTER TABLE `note` 
ADD COLUMN `deleted` TINYINT DEFAULT 0 COMMENT '是否删除：0=正常，1=已删除';

ALTER TABLE `note` 
ADD COLUMN `deleted_at` TIMESTAMP NULL COMMENT '删除时间';

ALTER TABLE `note` 
ADD INDEX idx_deleted (`deleted`);
```

### 查询优化
- 添加 `deleted` 字段索引
- 正常列表查询：`WHERE deleted = 0`
- 回收站查询：`WHERE deleted = 1`

---

## 🎯 后续优化建议

### 功能增强
- [ ] 自动清理：30 天后自动永久删除
- [ ] 批量操作：批量恢复/删除
- [ ] 搜索功能：在回收站中搜索
- [ ] 排序功能：按标题/删除时间排序
- [ ] 筛选功能：按分类/标签筛选

### 用户体验
- [ ] 添加加载骨架屏
- [ ] 添加空状态插图
- [ ] 添加操作动画
- [ ] 添加撤销功能（删除后 5 秒内可撤销）

### 性能优化
- [ ] 虚拟滚动（大量数据时）
- [ ] 懒加载
- [ ] 缓存优化

---

## ✨ 总结

回收站功能已完整实现，包括：
- ✅ 完整的后端 API（4 个接口）
- ✅ 完整的前端页面
- ✅ 软删除机制
- ✅ 恢复和永久删除
- ✅ 清空回收站
- ✅ 分页显示
- ✅ 响应式设计
- ✅ 安全验证

**现在可以开始测试了！** 🚀

---

**文档版本**: v1.0.0  
**最后更新**: 2024-12-20  
**作者**: 云笔记开发团队
