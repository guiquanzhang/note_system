# 🧪 测试回收站接口

## 问题分析

你的返回数据显示：
- 返回了 12 条笔记
- 所有笔记的 `deleted = 0`（正常笔记）
- `total = 0`（总数为 0）

**这说明调用的不是回收站接口，而是笔记列表接口！**

---

## 🔍 快速测试

### 步骤 1：直接测试后端接口

在浏览器控制台执行：

```javascript
// 1. 获取 token
const token = localStorage.getItem('token')
console.log('Token:', token)

// 2. 测试回收站接口
fetch('http://localhost:8080/api/note/trash?pageNum=1&pageSize=10', {
  headers: {
    'Authorization': `Bearer ${token}`
  }
})
.then(res => res.json())
.then(data => {
  console.log('回收站接口返回:', data)
  console.log('总数:', data.data.total)
  console.log('记录数:', data.data.records.length)
  if (data.data.records.length > 0) {
    console.log('第一条记录的 deleted:', data.data.records[0].deleted)
  }
})
```

**预期结果**：
- 如果有已删除笔记，应该返回 `deleted = 1` 的记录
- 如果没有，应该返回空数组

---

### 步骤 2：创建测试数据

执行这个 SQL：

```sql
USE cloudnote;

-- 将一条笔记标记为已删除（使用你的 user_id = 6）
UPDATE note 
SET deleted = 1, deleted_at = NOW() 
WHERE note_id = 15 AND user_id = 6;

-- 验证
SELECT note_id, title, user_id, deleted, deleted_at 
FROM note 
WHERE note_id = 15;
```

---

### 步骤 3：再次测试

执行步骤 1 的 JavaScript 代码，应该能看到 note_id = 15 的笔记。

---

## 🔧 前端问题排查

### 检查 1：确认访问的是回收站页面

在浏览器地址栏确认：
```
http://localhost:5173/notes/trash
```

### 检查 2：查看 Network 请求

1. 打开 F12 → Network 标签
2. 刷新回收站页面
3. 找到 API 请求
4. 确认请求 URL 是：`http://localhost:8080/api/note/trash`

**如果 URL 不对**：
- 可能是前端代码没有更新
- 需要清除缓存或重启前端

### 检查 3：清除缓存

```javascript
// 在浏览器控制台执行
localStorage.clear()
sessionStorage.clear()
location.reload()
```

然后重新登录，再访问回收站。

---

## 🚀 完整测试流程

### 1. 准备测试数据

```sql
USE cloudnote;

-- 查看你的 user_id
SELECT user_id, username FROM user;

-- 将几条笔记标记为已删除（替换 YOUR_USER_ID）
UPDATE note 
SET deleted = 1, deleted_at = NOW() 
WHERE user_id = 6 
  AND note_id IN (15, 14, 13);

-- 验证
SELECT note_id, title, deleted, deleted_at 
FROM note 
WHERE user_id = 6 AND deleted = 1;
```

### 2. 测试后端接口

```bash
# 使用 curl 测试（替换 YOUR_TOKEN）
curl -X GET "http://localhost:8080/api/note/trash?pageNum=1&pageSize=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

或在浏览器控制台：

```javascript
const token = localStorage.getItem('token')
fetch('http://localhost:8080/api/note/trash?pageNum=1&pageSize=10', {
  headers: { 'Authorization': `Bearer ${token}` }
})
.then(res => res.json())
.then(data => console.log(data))
```

**预期返回**：
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "records": [
      {
        "noteId": 15,
        "deleted": 1,
        "deletedAt": "2024-12-20T14:10:00"
      }
    ],
    "total": 3
  }
}
```

### 3. 测试前端页面

1. 访问 `http://localhost:5173/notes/trash`
2. 应该能看到 3 条已删除的笔记
3. 点击"恢复"按钮测试恢复功能

---

## 🐛 可能的问题

### 问题 1：后端接口没有注册

**检查**：后端控制台搜索
```
Mapped "{[/note/trash],methods=[GET]}"
```

**如果没有**：
1. 停止后端
2. Build → Rebuild Project
3. 重新运行

### 问题 2：前端调用了错误的接口

**检查**：F12 → Network，看请求 URL

**如果是 `/api/note/list`**：
- 前端代码没有更新
- 清除缓存：Ctrl + Shift + Delete
- 硬刷新：Ctrl + F5

### 问题 3：数据库没有已删除的笔记

**检查**：
```sql
SELECT COUNT(*) FROM note WHERE deleted = 1;
```

**如果是 0**：
- 删除功能没有正常工作
- 手动创建测试数据（见步骤 1）

---

## ✅ 验证清单

- [ ] 数据库中有 `deleted = 1` 的笔记
- [ ] 后端控制台有回收站接口映射
- [ ] 后端接口返回正确数据（用 curl 或浏览器测试）
- [ ] 前端访问的是 `/notes/trash` 路由
- [ ] Network 显示请求的是 `/api/note/trash`
- [ ] 前端页面显示已删除笔记

---

## 📝 快速命令

### 创建测试数据
```sql
USE cloudnote;
UPDATE note SET deleted = 1, deleted_at = NOW() WHERE note_id = 15 AND user_id = 6;
SELECT * FROM note WHERE deleted = 1;
```

### 测试接口
```javascript
// 浏览器控制台
fetch('http://localhost:8080/api/note/trash?pageNum=1&pageSize=10', {
  headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
}).then(r => r.json()).then(console.log)
```

### 清除缓存
```javascript
localStorage.clear(); location.reload()
```

---

**如果还是不行，请提供：**
1. 后端控制台的接口映射日志
2. 浏览器 Network 中的请求 URL
3. 数据库查询结果：`SELECT * FROM note WHERE deleted = 1`
