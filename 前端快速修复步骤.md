# 🔧 前端快速修复步骤

## 当前问题
1. ❌ "用户不存在" - 可能是 token 过期
2. ❌ "请输入用户名" - 表单验证失败（已修复）
3. ❌ 分类列表加载失败 - 后端异常

---

## 🚀 立即执行（按顺序）

### 步骤 1: 清除浏览器缓存（必须）

打开浏览器控制台（按 F12），在 Console 标签页执行：

```javascript
// 清除所有缓存
localStorage.clear()
sessionStorage.clear()

// 刷新页面
location.reload()
```

**或者手动操作**:
1. 按 F12 打开开发者工具
2. 点击 Application 标签
3. 左侧选择 Local Storage → http://localhost:5173
4. 右键 → Clear
5. 刷新页面（F5）

---

### 步骤 2: 执行数据库修复脚本

打开 MySQL 客户端，执行 `快速修复.sql` 文件：

```sql
-- 或者直接执行以下命令
USE cloudnote;

-- 修复 avatar 字段
ALTER TABLE `user` 
MODIFY COLUMN `avatar` VARCHAR(500) COMMENT '用户头像URL';

-- 查看用户数据
SELECT * FROM user;

-- 查看分类数据
SELECT * FROM category;
```

---

### 步骤 3: 重启后端服务

1. 停止当前运行的 Spring Boot 应用
2. 重新启动
3. 等待启动完成（看到 "Started CloudnoteApplication" 日志）

---

### 步骤 4: 重新登录

1. 访问 http://localhost:5173
2. 如果自动跳转到登录页，输入用户名和密码
3. 如果没有跳转，手动访问 http://localhost:5173/login

---

### 步骤 5: 测试功能

#### 测试 1: 个人信息加载
- [ ] 点击左侧菜单"个人信息"
- [ ] 页面能正常显示用户信息
- [ ] 没有报错

#### 测试 2: 头像上传
- [ ] 点击"编辑信息"
- [ ] 点击"选择头像"
- [ ] 选择一张图片（小于 5MB）
- [ ] 看到"头像已上传，请点击保存按钮"提示
- [ ] 点击"保存"
- [ ] 看到"信息更新成功"提示
- [ ] 头像正常显示

#### 测试 3: 笔记列表
- [ ] 点击左侧菜单"笔记列表"
- [ ] 页面能正常加载
- [ ] 分类筛选功能正常

---

## 🔍 如果问题仍然存在

### 检查 1: Token 是否存在

浏览器控制台执行：
```javascript
console.log('Token:', localStorage.getItem('token'))
```

- 如果显示 `null`，说明未登录，需要重新登录
- 如果显示一串字符，说明 token 存在

### 检查 2: 后端是否正常运行

浏览器访问：
```
http://localhost:8080/api/user/info
```

- 如果显示 "Unauthorized" 或 401，说明需要登录
- 如果显示 "用户不存在"，说明数据库有问题
- 如果无法访问，说明后端未启动

### 检查 3: 数据库连接

后端控制台应该看到：
```
HikariPool-1 - Start completed.
```

如果看到数据库连接错误，检查：
- MySQL 服务是否启动
- 用户名密码是否正确（root/123456）
- 数据库 cloudnote 是否存在

---

## 🆘 终极解决方案

如果以上步骤都无法解决，执行完全重置：

### 1. 完全清除前端
```javascript
// 浏览器控制台
localStorage.clear()
sessionStorage.clear()
caches.keys().then(keys => keys.forEach(key => caches.delete(key)))
location.href = '/login'
```

### 2. 重新注册用户
1. 访问 http://localhost:5173/register
2. 注册一个新用户
3. 登录测试

### 3. 检查文件权限
确保后端有权限创建 `uploads/avatars/` 目录

---

## 📊 诊断信息收集

如果问题仍未解决，请提供以下信息：

### 前端信息
```javascript
// 浏览器控制台执行
console.log({
  token: localStorage.getItem('token'),
  userInfo: localStorage.getItem('userInfo'),
  url: window.location.href
})
```

### 后端信息
- 后端控制台最后 50 行日志
- 是否看到 "用户不存在" 的完整堆栈信息

### 数据库信息
```sql
USE cloudnote;
SELECT COUNT(*) AS 用户数 FROM user;
SELECT COUNT(*) AS 分类数 FROM category;
SELECT COUNT(*) AS 笔记数 FROM note WHERE deleted = 0;
DESC user;
```

---

## ✅ 成功标志

修复成功后，你应该看到：

1. ✅ 登录后能正常访问个人信息页面
2. ✅ 能够上传头像并保存
3. ✅ 头像显示正常
4. ✅ 笔记列表能正常加载
5. ✅ 没有控制台错误

---

## 💡 预防措施

为了避免类似问题：

1. **定期清理缓存**: 开发时经常清除浏览器缓存
2. **检查后端日志**: 出现问题先看后端控制台
3. **验证数据库**: 修改表结构后验证是否生效
4. **备份数据**: 重要操作前备份数据库

---

**当前已修复**: ✅ Profile.vue 表单验证问题
**待执行**: 清除缓存 → 执行 SQL → 重启后端 → 重新登录
