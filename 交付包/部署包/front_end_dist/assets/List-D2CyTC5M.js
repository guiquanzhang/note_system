import"./index-DbT8dq-d.js";import{u as H,g as R,d as j,a as q,c as K}from"./category-CzVHQ6Cc.js";import{y as n,N as W,c as w,o as C,a as k,b as t,w as l,r as o,K as p,Z as X,d as u,f as Z,U as F,X as G,Y as J,k as O,t as P,a0 as Q,W as ee}from"./index-CxuP8R5R.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-CqNpOxbT.js";const ae={class:"category-page"},le={class:"page-header"},oe={key:0,class:"empty-tip"},se={__name:"List",setup(ne){const x=H(),_=n([]),c=n(!1),i=n(!1),m=n(!1),v=n(!1),g=n(null),y=n(null),r=n({name:""}),V={name:[{required:!0,message:"请输入分类名称",trigger:"blur"},{min:1,max:20,message:"分类名称不能超过20个字符",trigger:"blur"}]},b=async()=>{c.value=!0;try{const a=await R();_.value=a||[],await x.fetchCategoryList()}catch{p.error("加载分类失败")}finally{c.value=!1}},D=()=>{m.value=!1,r.value={name:""},y.value=null,i.value=!0},h=a=>{m.value=!0,r.value={name:a.name},y.value=a.categoryId,i.value=!0},B=async()=>{if(g.value)try{await g.value.validate(),v.value=!0,m.value?(await q(y.value,r.value),p.success("更新成功")):(await K(r.value),p.success("创建成功")),i.value=!1,b()}catch(a){a!==!1&&console.error("提交失败:",a)}finally{v.value=!1}},I=async a=>{try{await ee.confirm(`确定要删除分类"${a.name}"吗？删除后该分类下的笔记将变为未分类。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await j(a.categoryId),p.success("删除成功"),b()}catch(e){e!=="cancel"&&console.error("删除失败:",e)}},E=a=>a?Q(a).format("YYYY-MM-DD HH:mm"):"-";return W(()=>{b()}),(a,e)=>{const L=o("el-icon"),d=o("el-button"),f=o("el-table-column"),M=o("el-table"),N=o("el-empty"),Y=o("el-card"),S=o("el-input"),T=o("el-form-item"),$=o("el-form"),A=o("el-dialog"),U=X("loading");return C(),w("div",ae,[k("div",le,[e[4]||(e[4]=k("h2",null,"分类管理",-1)),t(d,{type:"primary",onClick:D},{default:l(()=>[t(L,null,{default:l(()=>[t(Z(F))]),_:1}),e[3]||(e[3]=u(" 新建分类 ",-1))]),_:1})]),t(Y,{class:"category-card"},{default:l(()=>[G((C(),O(M,{data:_.value,style:{width:"100%"}},{default:l(()=>[t(f,{prop:"categoryId",label:"ID",width:"80"}),t(f,{prop:"name",label:"分类名称"}),t(f,{prop:"createdAt",label:"创建时间",width:"180"},{default:l(({row:s})=>[u(P(E(s.createdAt)),1)]),_:1}),t(f,{label:"操作",width:"200",fixed:"right"},{default:l(({row:s})=>[t(d,{type:"primary",size:"small",onClick:z=>h(s)},{default:l(()=>[...e[5]||(e[5]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(d,{type:"danger",size:"small",onClick:z=>I(s)},{default:l(()=>[...e[6]||(e[6]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,c.value]]),_.value.length===0&&!c.value?(C(),w("div",oe,[t(N,{description:"暂无分类，点击上方按钮创建"})])):J("",!0)]),_:1}),t(A,{modelValue:i.value,"onUpdate:modelValue":e[2]||(e[2]=s=>i.value=s),title:m.value?"编辑分类":"新建分类",width:"400px"},{footer:l(()=>[t(d,{onClick:e[1]||(e[1]=s=>i.value=!1)},{default:l(()=>[...e[7]||(e[7]=[u("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:B,loading:v.value},{default:l(()=>[...e[8]||(e[8]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t($,{model:r.value,rules:V,ref_key:"formRef",ref:g,"label-width":"80px"},{default:l(()=>[t(T,{label:"分类名称",prop:"name"},{default:l(()=>[t(S,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.name=s),placeholder:"请输入分类名称",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},me=te(se,[["__scopeId","data-v-f41992c1"]]);export{me as default};
