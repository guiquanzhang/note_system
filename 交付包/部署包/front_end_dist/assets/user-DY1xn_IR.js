import{a9 as o,ac as s,K as t}from"./index-CxuP8R5R.js";import{r as n}from"./request-CqNpOxbT.js";function u(r){return n({url:"/user/register",method:"post",data:r})}function a(r){return n({url:"/user/login",method:"post",data:r})}function g(){return n({url:"/user/info",method:"get"})}function c(r){return n({url:"/user/info",method:"put",data:r})}function I(r){return n({url:"/user/password",method:"put",data:r})}const h=o("user",{state:()=>({token:s.getToken()||"",userInfo:s.getUserInfo()||null,isLoggedIn:!!s.getToken()}),getters:{username:r=>{var e;return((e=r.userInfo)==null?void 0:e.username)||""},userId:r=>{var e;return((e=r.userInfo)==null?void 0:e.userId)||null},email:r=>{var e;return((e=r.userInfo)==null?void 0:e.email)||""},avatar:r=>{var e;return((e=r.userInfo)==null?void 0:e.avatar)||""},isAuthenticated:r=>r.isLoggedIn},actions:{async login(r){try{const e=await a(r);return this.token=e.token,s.setToken(e.token),this.userInfo={userId:e.userId,username:e.username,email:e.email,avatar:e.avatar||""},s.setUserInfo(this.userInfo),this.isLoggedIn=!0,t.success("登录成功！"),e}catch(e){throw t.error(e.message||"登录失败"),e}},async register(r){try{return await u(r),t.success("注册成功！请登录"),!0}catch(e){throw t.error(e.message||"注册失败"),e}},logout(){this.token="",this.userInfo=null,this.isLoggedIn=!1,s.clearAuth(),t.success("已退出登录")},setUserInfo(r){this.userInfo=r,s.setUserInfo(r)},checkAuth(){const r=s.getToken(),e=s.getUserInfo();return r&&e?(this.token=r,this.userInfo=e,this.isLoggedIn=!0,!0):!1}}});export{c as a,I as b,g,h as u};
