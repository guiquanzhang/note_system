import{a9 as i,K as a}from"./index-CxuP8R5R.js";import{d as o,u as h,c,g as n,s as l,a as u}from"./note-CSOVseSf.js";const d=i("note",{state:()=>({noteList:[],currentNote:null,total:0,pageNum:1,pageSize:10,loading:!1,searchKeyword:""}),getters:{hasNotes:t=>t.noteList.length>0,totalPages:t=>Math.ceil(t.total/t.pageSize),isSearching:t=>!!t.searchKeyword},actions:{async fetchNoteList(t=1,e=10){try{this.loading=!0,this.pageNum=t,this.pageSize=e;const r=await u({pageNum:t,pageSize:e});return this.noteList=r.records||[],this.total=r.total||0,r}catch(r){throw a.error("获取笔记列表失败"),r}finally{this.loading=!1}},async searchNotes(t,e=1,r=10){try{this.loading=!0,this.searchKeyword=t,this.pageNum=e,this.pageSize=r;const s=await l({keyword:t,pageNum:e,pageSize:r});return this.noteList=s.records||[],this.total=s.total||0,s}catch(s){throw a.error("搜索笔记失败"),s}finally{this.loading=!1}},clearSearch(){this.searchKeyword="",this.fetchNoteList(1,this.pageSize)},async fetchNoteDetail(t){try{this.loading=!0;const e=await n(t);return this.currentNote=e,e}catch(e){throw a.error("获取笔记详情失败"),e}finally{this.loading=!1}},async createNote(t){try{return await c(t),a.success("创建笔记成功"),await this.fetchNoteList(this.pageNum,this.pageSize),!0}catch(e){throw a.error("创建笔记失败"),e}},async updateNote(t,e){var r;try{return await h(t,e),a.success("更新笔记成功"),await this.fetchNoteList(this.pageNum,this.pageSize),((r=this.currentNote)==null?void 0:r.noteId)===t&&await this.fetchNoteDetail(t),!0}catch(s){throw a.error("更新笔记失败"),s}},async deleteNote(t){var e;try{return await o(t),a.success("删除笔记成功"),await this.fetchNoteList(this.pageNum,this.pageSize),((e=this.currentNote)==null?void 0:e.noteId)===t&&(this.currentNote=null),!0}catch(r){throw a.error("删除笔记失败"),r}},setCurrentNote(t){this.currentNote=t},clearCurrentNote(){this.currentNote=null},reset(){this.noteList=[],this.currentNote=null,this.total=0,this.pageNum=1,this.pageSize=10,this.loading=!1,this.searchKeyword=""}}});export{d as u};
