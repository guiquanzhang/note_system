import{u as G,g as J,a as L,b as Q}from"./user-DY1xn_IR.js";import{a as X}from"./file-C-GaMayY.js";import"./index-DbT8dq-d.js";import{g as Z}from"./avatar-CoqCFoW7.js";import{y as b,z as I,N as h,K as p,c as x,o as y,a as o,b as a,w as l,r as f,Y as R,f as C,i as ee,k as M,d as v,F as ae,m as le,B as se,t as N,a0 as te}from"./index-CxuP8R5R.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-CqNpOxbT.js";const re={class:"profile-page"},ne={class:"avatar-upload"},ie={key:0,class:"avatar-actions"},de={class:"security-section"},ue={class:"security-items"},me={class:"security-item"},fe={class:"item-left"},ce={class:"security-item"},pe={class:"item-left"},ve={class:"item-info"},we={class:"item-desc"},_e={__name:"Profile",setup(ge){const F=G(),k=b("basic"),n=I({userId:null,username:"",email:"",createdAt:null,updatedAt:null}),s=I({username:"",nickname:"",email:"",avatar:""}),w=b(!1),_=b(!1),V=b(null),Y={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],nickname:[{max:20,message:"昵称长度不能超过 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},i=I({oldPassword:"",newPassword:"",confirmPassword:""}),P=b(null),q={oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:(t,e,d)=>{e===""?d(new Error("请再次输入新密码")):e!==i.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]};h(()=>{B()});const B=async()=>{try{const t=await J();Object.assign(n,t),s.username=t.username,s.nickname=t.nickname||"",s.email=t.email||"",s.avatar=t.avatar||""}catch{p.error("加载用户信息失败")}},D=()=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=async e=>{const d=e.target.files[0];if(d){if(!d.type.startsWith("image/")){p.error("请选择图片文件");return}if(d.size>5*1024*1024){p.error("头像大小不能超过 5MB");return}try{const g=p({message:"正在上传图片...",type:"info",duration:0}),m=await X(d);s.avatar=m,s.username||(s.username=n.username,s.nickname=n.nickname||"",s.email=n.email||""),g.close(),p.success("头像已上传，请点击保存按钮")}catch(g){p.error("上传图片失败: "+(g.message||"未知错误"))}}},t.click()},S=()=>{s.avatar="",p.success("头像已移除，请点击保存按钮")},T=()=>{w.value=!0},j=()=>{var t;w.value=!1,s.username=n.username,s.nickname=n.nickname||"",s.email=n.email||"",s.avatar=n.avatar||"",(t=V.value)==null||t.clearValidate()},H=async()=>{if(V.value)try{await V.value.validate(),_.value=!0,await L(s),p.success("信息更新成功"),w.value=!1,await B(),F.setUserInfo({...F.userInfo,username:s.username,email:s.email,avatar:s.avatar,nickname:s.nickname})}catch(t){t!==!1&&console.error("更新失败:",t)}finally{_.value=!1}},$=async()=>{if(P.value)try{await P.value.validate(),_.value=!0,await Q(i),p.success("密码修改成功，请重新登录"),A(),setTimeout(()=>{localStorage.clear(),window.location.href="/login"},3e3)}catch(t){t!==!1&&console.error("修改密码失败:",t)}finally{_.value=!1}},A=()=>{var t;i.oldPassword="",i.newPassword="",i.confirmPassword="",(t=P.value)==null||t.clearValidate()},z=t=>t?te(t).format("YYYY-MM-DD HH:mm:ss"):"-";return(t,e)=>{const d=f("el-icon"),g=f("el-avatar"),m=f("el-button"),u=f("el-form-item"),c=f("el-input"),E=f("el-form"),U=f("el-tab-pane"),K=f("el-alert"),O=f("el-tabs"),W=f("el-card");return y(),x("div",re,[e[21]||(e[21]=o("div",{class:"page-header"},[o("h2",null,"个人信息")],-1)),a(W,{class:"profile-card"},{default:l(()=>[a(O,{modelValue:k.value,"onUpdate:modelValue":e[9]||(e[9]=r=>k.value=r)},{default:l(()=>[a(U,{label:"基本信息",name:"basic"},{default:l(()=>[a(E,{ref_key:"basicFormRef",ref:V,model:s,rules:Y,"label-width":"100px",class:"profile-form"},{default:l(()=>[a(u,{label:"头像"},{default:l(()=>[o("div",ne,[a(g,{size:80,src:C(Z)(s.avatar),class:"avatar-preview"},{default:l(()=>[a(d,{size:40},{default:l(()=>[a(C(ee))]),_:1})]),_:1},8,["src"]),w.value?(y(),x("div",ie,[a(m,{size:"small",onClick:D},{default:l(()=>[...e[10]||(e[10]=[v("选择头像",-1)])]),_:1}),s.avatar?(y(),M(m,{key:0,size:"small",onClick:S},{default:l(()=>[...e[11]||(e[11]=[v("移除",-1)])]),_:1})):R("",!0)])):R("",!0)])]),_:1}),a(u,{label:"用户ID"},{default:l(()=>[a(c,{modelValue:n.userId,"onUpdate:modelValue":e[0]||(e[0]=r=>n.userId=r),disabled:""},null,8,["modelValue"])]),_:1}),a(u,{label:"用户名",prop:"username"},{default:l(()=>[a(c,{modelValue:s.username,"onUpdate:modelValue":e[1]||(e[1]=r=>s.username=r),placeholder:"请输入用户名",disabled:!w.value},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"昵称",prop:"nickname"},{default:l(()=>[a(c,{modelValue:s.nickname,"onUpdate:modelValue":e[2]||(e[2]=r=>s.nickname=r),placeholder:"请输入昵称（可选）",disabled:!w.value,maxlength:"20","show-word-limit":""},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"邮箱",prop:"email"},{default:l(()=>[a(c,{modelValue:s.email,"onUpdate:modelValue":e[3]||(e[3]=r=>s.email=r),placeholder:"请输入邮箱",disabled:!w.value},null,8,["modelValue","disabled"])]),_:1}),a(u,{label:"注册时间"},{default:l(()=>[a(c,{value:z(n.createdAt),disabled:""},null,8,["value"])]),_:1}),a(u,{label:"更新时间"},{default:l(()=>[a(c,{value:z(n.updatedAt),disabled:""},null,8,["value"])]),_:1}),a(u,null,{default:l(()=>[w.value?(y(),x(ae,{key:1},[a(m,{type:"primary",loading:_.value,onClick:H},{default:l(()=>[...e[13]||(e[13]=[v(" 保存 ",-1)])]),_:1},8,["loading"]),a(m,{onClick:j},{default:l(()=>[...e[14]||(e[14]=[v("取消",-1)])]),_:1})],64)):(y(),M(m,{key:0,type:"primary",onClick:T},{default:l(()=>[...e[12]||(e[12]=[v(" 编辑信息 ",-1)])]),_:1}))]),_:1})]),_:1},8,["model"])]),_:1}),a(U,{label:"修改密码",name:"password"},{default:l(()=>[a(E,{ref_key:"passwordFormRef",ref:P,model:i,rules:q,"label-width":"100px",class:"profile-form"},{default:l(()=>[a(u,{label:"旧密码",prop:"oldPassword"},{default:l(()=>[a(c,{modelValue:i.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=r=>i.oldPassword=r),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"新密码",prop:"newPassword"},{default:l(()=>[a(c,{modelValue:i.newPassword,"onUpdate:modelValue":e[5]||(e[5]=r=>i.newPassword=r),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[a(c,{modelValue:i.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=r=>i.confirmPassword=r),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),a(u,null,{default:l(()=>[a(m,{type:"primary",loading:_.value,onClick:$},{default:l(()=>[...e[15]||(e[15]=[v(" 修改密码 ",-1)])]),_:1},8,["loading"]),a(m,{onClick:A},{default:l(()=>[...e[16]||(e[16]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(U,{label:"账户安全",name:"security"},{default:l(()=>[o("div",de,[a(K,{title:"账户安全提示",type:"info",closable:!1,"show-icon":""},{default:l(()=>[...e[17]||(e[17]=[o("ul",{class:"security-tips"},[o("li",null,"定期修改密码，建议每 3 个月更换一次"),o("li",null,"密码长度至少 6 位，建议包含字母、数字和特殊字符"),o("li",null,"不要在多个网站使用相同的密码"),o("li",null,"绑定邮箱可以帮助您找回密码")],-1)])]),_:1}),o("div",ue,[o("div",me,[o("div",fe,[a(d,{size:24,color:"#67C23A"},{default:l(()=>[a(C(le))]),_:1}),e[18]||(e[18]=o("div",{class:"item-info"},[o("div",{class:"item-title"},"登录密码"),o("div",{class:"item-desc"},"定期修改密码可以提高账户安全性")],-1))]),a(m,{type:"primary",link:"",onClick:e[7]||(e[7]=r=>k.value="password")},{default:l(()=>[...e[19]||(e[19]=[v(" 修改密码 ",-1)])]),_:1})]),o("div",ce,[o("div",pe,[a(d,{size:24,color:"#409EFF"},{default:l(()=>[a(C(se))]),_:1}),o("div",ve,[e[20]||(e[20]=o("div",{class:"item-title"},"绑定邮箱",-1)),o("div",we,N(n.email||"未绑定邮箱"),1)])]),a(m,{type:"primary",link:"",onClick:e[8]||(e[8]=r=>k.value="basic")},{default:l(()=>[v(N(n.email?"修改邮箱":"绑定邮箱"),1)]),_:1})])])])]),_:1})]),_:1},8,["modelValue"])]),_:1})])}}},xe=oe(_e,[["__scopeId","data-v-6e6f9af9"]]);export{xe as default};
